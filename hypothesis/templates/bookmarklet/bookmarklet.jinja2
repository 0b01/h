(function(a,b,c){"use strict";var d=c.body,e=c.getElementsByTagName("head")[0],f=["Annotator","$","jQuery"],g={},h={},i,j,k;while(f.length)j=f.shift(),g[j]=b.hasOwnProperty(j);i=function(){var a=c.createElement("div"),b="top 0.4s ease-out",e={display:"block",position:"absolute",fontFamily:'"Helvetica Neue", Arial, Helvetica, sans-serif',fontSize:"14px",color:"#fff",top:"-54px",left:0,width:"100%",zIndex:9999,lineHeight:"50px",textAlign:"center",backgroundColor:"#000",borderBottom:"4px solid",WebkitTransition:b,MozTransition:b,OTransition:b,transition:b},f;a.className="annotator-bm-status";for(f in e)e.hasOwnProperty(f)&&(a.style[f]=e[f]);return a.style.position="fixed",a.style.backgroundColor="rgba(0, 0, 0, 0.9)",a.onclick=function(){this.parentNode.removeChild(this)},{status:{INFO:"#d4d4d4",SUCCESS:"#3665f9",ERROR:"#ff7e00"},element:a,show:function(b,c){return this.message(b,c),a.style.display="block",a.style.visibility="visible",a.style.top="0",this},hide:function(){return a.style.top="-54px",setTimeout(function(){a.style.display="none",a.style.visibility="hidden"},400),this},message:function(b,c){return c=c||this.status.INFO,a.style.borderColor=c,a.innerHTML=b,this},error:function(a){this.message(a,this.status.ERROR),setTimeout(this.hide,5e3),setTimeout(this.remove,5500)},append:function(){return d.appendChild(a),this},remove:function(){var b=a.parentNode;return b&&b.removeChild(a),this}}.append()}(),h={notification:i,keypath:function(a,b,c){var d=(b||"").split("."),e;while(a&&d.length){e=d.shift();if(!a.hasOwnProperty(e))break;a=a[e];if(d.length===0&&a!==undefined)return a}return c===null?null:c},config:function(b,c){var d=this.keypath(a,b,c);return d===null&&i.error("Sorry, there was an error reading the bookmarklet setting for key: "+b),d},loadjQuery:function(){var a=c.createElement("script"),e="https://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js",f;f=setTimeout(function(){i.error("Sorry, we were unable to load jQuery which is required by the annotator")},this.config("timeout",3e3)),a.src=this.config("externals.jQuery",e),a.onload=function(){k=b.jQuery,clearTimeout(f),d.removeChild(a),h.load(function(){b.jQuery.noConflict(!0),h.setup()})},d.appendChild(a)},load:function(a){var b=this.config("externals.source","http://assets.annotateit.org/bookmarklet/annotator.min.js"),c=this.config("externals.styles","http://assets.annotateit.org/bookmarklet/annotator.min.css");e.appendChild(k("<link />",{rel:"stylesheet",href:c})[0]),k.ajaxSetup({timeout:this.config("timeout",3e3)}),k.getScript(b,a).error(function(){i.error("Sorry, we're unable to load Annotator at the moment...")})},authOptions:function(){return{tokenUrl:this.config("auth.tokenUrl","http://annotateit.org/api/token")}},storeOptions:function(){var a=location.href.split(/#|\?/).shift();return{prefix:this.config("store.prefix","http://annotateit.org/api"),annotationData:{uri:a},loadFromSearch:{uri:a}}},annotateItPermissionsOptions:function(){return this.config("annotateItPermissions",{})},setup:function(){var c=new b.Annotator(a.target||d),e;c.addPlugin("Unsupported").addPlugin("Auth",this.authOptions()).addPlugin("Store",this.storeOptions()).addPlugin("AnnotateItPermissions",this.annotateItPermissionsOptions()),this.config("tags")===!0&&c.addPlugin("Tags"),k.extend(b._annotator,{jQuery:k,element:d,instance:c,Annotator:b.Annotator.noConflict()});for(e in g)g.hasOwnProperty(e)&&!g[e]&&delete b[e];i.message("Annotator is ready!",i.status.SUCCESS),setTimeout(function(){i.hide(),setTimeout(i.remove,800)},3e3)},init:function(){b._annotator.instance?b._annotator.Annotator.showNotification("Annotator is already loaded. Try highlighting some text to get started."):(i.show("Loading Annotator into page"),!b.jQuery||!b.jQuery.sub?this.loadjQuery():(k=b.jQuery.sub(),this.load(k.proxy(this.setup,this))))}},b._annotator||(b._annotator={bookmarklet:h}),a.test?k=b.jQuery:h.init()})({externals:{source:"{{root}}/assets/annotator/annotator-full.min.js",styles:"{{root}}/assets/annotator/annotator.min.css",d3:"{{root}}/assets/d3/d3.min.js"},auth:{tokenUrl:"{{root}}/api/token"},store:{prefix:"{{root}}/api"}},this,this.document);