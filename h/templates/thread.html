<a href="" class="threadexp"
   title="{{vm.collapsed && 'Expand' || 'Collapse'}}"
   ng-if="vm.container.parent.parent && shouldShowThread(vm.container)"
   ><span ng-class="{'icon-plus': !!vm.collapsed,
                     'icon-minus': !vm.collapsed}"></span></a>

<!-- Show more -->
<a href=""
   class="load-more"
   ng-if="vm.container.moreTop > 0"
   ng-click="showMoreTop(vm.container); $event.stopPropagation()"
   ng-pluralize=""
   count="vm.container.moreTop"
   when="{one: 'Show one other annotation in conversation.',
          other: 'Show {} other annotations in conversation.'}"></a>

<article ng-show="shouldShowThread(vm.container)">
  <!-- Annotation -->
  <div class="annotation"
       name="annotation"
       annotation="vm.container.message"
       annotation-embedded="{{isEmbedded}}"
       ng-if="vm.container.message">
  </div>

  <div ng-if="!vm.container.message"><em>Annotation unavailable.</em></div>

  <!-- Share -->
  <div class="share-dialog"
       ng-show="vm.shared"
       ng-click="$event.stopPropagation()">
    <a class="icon-export"
       target="_blank"
       ng-href="{{baseURI}}a/{{vm.container.message.id}}"></a>
    <div>
      <input type="text"
             ng-blur="vm.toggleShared()"
             value="{{baseURI}}a/{{vm.container.message.id}}"
             readonly>
    </div>
  </div>

  <!-- Reply count -->
  <a class="reply-count small"
     href=""
     ng-pluralize=""
     ng-if="vm.container.children.length"
     count="vm.container.flattenChildren().length"
     when="{one: '1 reply', other: '{} replies'}" />

  <!-- Bottom control strip -->
  <a class="small magicontrol" href="" title="Reply"
     ng-click="vm.reply(); $event.stopPropagation()"
     ng-if="vm.container.message.id"
     ><i class="icon-reply"></i> Reply</a>
  <a class="small magicontrol" href="" title="Share"
     ng-click="vm.toggleShared(); $event.stopPropagation()"
     ng-if="vm.container.message.id"
     ><i class="icon-export"></i> Share</a>
</article>


<!-- Show more -->
<a href=""
   class="load-more"
   ng-if="vm.container.moreBottom > 0"
   ng-click="showMoreBottom(vm.container); $event.stopPropagation()"
   ng-pluralize=""
   count="vm.container.moreBottom"
   when="{one: 'Show one other annotation in conversation.',
          other: 'Show {} other annotations in conversation.'}"></a>

<!-- Replies -->
<ul>
  <li class="thread"
      thread="child"
      ng-include="'thread.html'"
      ng-repeat="child in vm.container.children
                 | orderBy : 'message.updated'"></li>
</ul>
