<a href="" class="threadexp"
   title="{{vm.collapsed && 'Expand' || 'Collapse'}}"
   ng-if="vm.container.parent.parent && shouldShowThread(vm.container)"
   ><span ng-class="{'icon-plus': !!vm.collapsed,
                     'icon-minus': !vm.collapsed}"></span></a>

<article ng-if="vm.container" ng-show="shouldShowThread(vm.container)">
  <!-- Annotation -->
  <div class="annotation"
       name="annotation"
       annotation="vm.container.message"
       annotation-embedded="{{isEmbedded}}"
       ng-if="vm.container.message">
  </div>

  <footer>
    <!-- Share -->
    <div class="share-dialog"
         ng-show="vm.shared"
         ng-click="$event.stopPropagation()">
      <a class="icon-export"
         target="_blank"
         ng-href="{{baseURI}}a/{{vm.container.message.id}}"></a>
      <div>
        <input type="text"
               ng-blur="vm.toggleShared()"
               value="{{baseURI}}a/{{vm.container.message.id}}"
               readonly>
      </div>
    </div>

    <!-- Reply count -->
    <a class="reply-count small"
       href=""
       ng-pluralize=""
       ng-if="vm.container.children.length && !vm.container.more"
       count="vm.container.flattenChildren().length"
       when="{one: '1 reply', other: '{} replies'}" />

    <!-- Bottom control strip -->
    <a class="small magicontrol" href="" title="Reply"
       ng-click="vm.reply(); $event.stopPropagation()"
       ><i class="icon-reply"></i> Reply</a>
    <a class="small magicontrol" href="" title="Share"
       ng-click="vm.toggleShared(); $event.stopPropagation()"
       ><i class="icon-export"></i> Share</a>
  </footer>
</article>

<!-- Show more -->
<a href=""
   class="load-more"
   ng-if="vm.container.more > 0"
   ng-click="showMore(vm.container); $event.stopPropagation()"
   ng-pluralize=""
   count="vm.container.more"
   when="{one: 'Show one reply in another branch of this conversation.',
          other: 'Show {} replies in other branches of this conversation.'}"
   ></a>

<!-- Replies -->
<ul>
  <li class="thread"
      thread="child"
      ng-include="'thread.html'"
      ng-repeat="child in vm.container.children
                 | orderBy : 'message.updated'"></li>
</ul>
