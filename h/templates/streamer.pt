<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html metal:use-macro="main_template" >
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <!-- Always force latest IE rendering engine (even in intranet) &amp; Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <title>Test Streamer</title>
    <link href="css/displayer.css" rel="stylesheet" type="text/css">  
  </head>
  <style type="text/css"></style>

  <body metal:fill-slot="body" ng-app="h.streamer">
    <div ng-controller="StreamerCtrl">
    <div class="topbar">
      <div class="inner">
        <div class="barbutton pull-left">
          <h4>hypothes<span class="red">.</span>is</h4>
        </div>
        <div class="barbutton pull-left">
          <h4 ng-show="streaming" class="small">Streaming :)</h4>
          <h4 ng-hide="streaming" class="small">Not streaming <span class="red">:(</span></h4>
        </div>
        <div class="barbutton pull-right">
          <h4>sign in</h4>
        </div>
      </div>
    </div>


    <div class="main-content">
      <div class="small-padding content paper">  
        <div class="knockout noise">
          <div class="paper excerpt filter-body">

            <!-- Searchbar -->
            <div class="searchbar-border">
              <h4>
                <div class="pull-left searchinput">
                  <input type="text" class="searchfield" ng-model="clauses" placeholder="search options"/>
                </div>
                <div class="pull-right searchbutton">
                  <button ng-hide="streaming" ng-click="start_streaming()" class="btn check-icon">Stream</button>
                  <button ng-show="streaming" ng-click="stop_streaming()" class="btn check-icon">Stop</button>
                </div>
              </h4>
              <ul class="searchbar-error small" ng-show="bads.length>0" ng-repeat="bad in bads">
                  <li>Error: '{{bad[0]}}' : {{bad[1]}}</li>
              </ul>
            </div>

            <div class="button_controls">
              <!-- Match Strategy -->  
              <div class="dropdown show pull-left">
                <a href="" class="down-icon dropdown-toggle small" role="button" title="Match Strategy">Strategy:&nbsp;{{matchPolicy}}</a>
                <ul class="dropdown-menu" role="menu">                
                  <li ng-click="matchPolicy = 'include_all'" class="small">include_all</li>
                  <li ng-click="matchPolicy = 'include_any'" class="small">include_any</li>
                  <li ng-click="matchPolicy = 'exclude_all'" class="small">exclude_all</li>
                  <li ng-click="matchPolicy = 'exclude_any'" class="small">exclude_any</li>
                </ul>
              </div>

             <!-- Annotation actions -->  
             <div class="dropdown show pull-left">
              <a href="" class="down-icon dropdown-toggle small" role="button" title="Annotation actions">Actions</a>
              <ul class="dropdown-menu" role="menu">                
                <li ng-click="action['create'] = !action['create']" class="small"><input type="checkbox" data-col="1" ng-model="action['create']" class="small">Create</input><li>
                <li ng-click="action['edit'] = !action['edit']" class="small"><input type="checkbox" data-col="1" ng-model="action['edit']" class="small">Edit</input><li>
                <li ng-click="action['delete'] = !action['delete']" class="small"><input type="checkbox" data-col="1" ng-model="action['delete']" class="small">Delete</input><li>
              </ul>
             </div>

            <!-- Past -->
            <div class="dropdown show pull-left">
               <a href="" class="down-icon dropdown-toggle small" role="button" title="Past">Past</a>
              <ul class="dropdown-menu" role="menu">                
                <li ng-click="past['load_past'] = (past['load_past']+1)%3" class="small">Load {{past_list[past['load_past']]}}</li>
                <li class="small" ng-hide="past['load_past'] != 1">Go back <input type="number" ng-model="past['go_back']" step="1" min="1" max="60" value="5"/> min(s)<li>
                <li class="small" ng-hide="past['load_past'] != 2">Load <input type="number" ng-model="past['hits']" step="10" min="1" max="500" value="20"/> hits<li>
              </ul>
          </div>

          <!-- Sidebar links -->
          <div class="pull-right">
            <div>
              <a href="" ng-hide="sidebar" ng-click="sidebar=!sidebar" class="small">Show help</a>
              <a href="" ng-show="sidebar" ng-click="sidebar=!sidebar" class="small">Hide help</a>
              <a href="" ng-hide="sidebar_json" ng-click="show_sidebar_json()" class="small">Show json</a>
              <a href="" ng-show="sidebar_json" ng-click="sidebar_json=!sidebar_json" class="small">Hide json</a>
            </div>
          </div>  
           </div>
        </div>

        </div>
      </div>   
     
      <ul class="small-padding content paper">
        <div class="knockout noise">
          <div class="metadata">
            <div>
              <li class="stream-list" ng-repeat="annotation in annotations">
                <div class="page">
                  <strong>{{annotation['user'] | userName}}</strong>
                  <span ng-switch="annotation['action']">
                    <span ng-switch-when="past">&nbsp;'s annotation</span>
                    <span ng-switch-when="create">&nbsp;has created an annotation</span>
                    <span ng-switch-when="update">&nbsp;has updated an annotation</span>
                    <span ng-switch-when="delete">&nbsp;has deleted an annotation</span>
                  </span> 
                  <div class="domain">
                    <img class="favicon" ng-model="annotation['favicon']"/>
                    <a href="{{annotation['uri']}}">{{annotation['title']}}</a> 
                    | 
                    <a href="{{annotation['source']}}">{{annotation['source_stripped']}}</a>
                  </div>
                </div>

                <div class="paper excerpt">
                  <blockquote>{{annotation['quote']}}</blockquote>
                </div>

                <div class="paper thread">
                  <div class="annotation detail">
                    <div class="magicontrols pull-right">
                      <span class="small">{{annotation['updated'] | fuzzyTime}}</span>
                    </div>
                    <strong>
                      <span class="user">{{annotation['user'] | userName}}</span>
                    </strong>
                    <div class="body">{{annotation['text']}}</div>
                  </div>
                </div>
              </li>
            </div>
          </div>
        </div>
      </ul>
     </div>

     <div class="side-bar-left" ng-show="sidebar_json" ng-animate="{show: 'sidebar_anim_show_left', hide: 'sidebar_anim_hide_left'}">
       <div class="sidebar-content paper">
         <h4>Generated filter json
         <pre ng-bind-html-unsafe="json_content"/>
         </h4>
         <div class="center_button">
           <button ng-click="show_sidebar_json()" class="btn">Refresh</button>
           <button ng-click="sidebar_json=!sidebar_json" class="btn">Close sidebar</button>
         </div>
       </div>
     </div>

     <div class="side-bar-right" ng-show="sidebar" ng-animate="{show: 'sidebar_anim_show_right', hide: 'sidebar_anim_hide_right'}">
       <div class="sidebar-content paper">
        <h4>
          Little help for the search options syntax. 
        </h4>  
        <h4>
          This is still experimental and our goal is to form it as natural as possible.
        </h4>
        <h4>  
          <li>
            Currently you can type search clauses, separated by space characters.
          </li>  
          <li>
            A search clause has the following structure: <strong>(field):(operator)(value)</strong> (i.e. <strong>user:=johndoe</strong> )
          </li>  
          <li>
            The fields can be one of the followings: <strong>['thread', 'text', 'user']</strong>
          </li>
          <li>
            Operators: <strong>['=', '>', '<', '=>', '<=', '[', '#']</strong>
          </li>  
          <li>
            Where '[' means a comma separated list. I.e. <strong>user:[johndoe,janedoe</strong> means the user is either johndoe or janedoe
          </li>  
          <li>
            '#' means matching (or substring). i.e <strong>text:#car</strong> means every annotation which has the 'car' character string in it's body.   
          </li>
        </h4>  
      </div>

     </div>
   </div>
  </body>
</html>
