<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html metal:use-macro="main_template" >
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <!-- Always force latest IE rendering engine (even in intranet) &amp; Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <title>Test Streamer</title>
    <link href="css/displayer.css" rel="stylesheet" type="text/css">  
  </head>
  <style type="text/css"></style>

  <body metal:fill-slot="body" ng-app="h.streamer">
    <script type="text/javascript">var port = ${port};</script>
    <div ng-controller="StreamerCtrl">
    <div class="topbar">
      <div class="inner">
        <div class="barbutton pull-left">
          <h4>hypothes<span class="red">.</span>is</h4>
        </div>
        <div class="barbutton pull-left">
          <h4 ng-show="streaming">Streaming :)</h4>
          <h4 ng-hide="streaming">Not streaming <span class="red">:(</span></h4>
        </div>
        <div class="barbutton pull-right">
          <span>sign up</span>
        </div>
      </div>
    </div>


    <div class="main-content">
      <div class="small-padding content paper">  
        <div class="knockout noise">
          <div class="paper excerpt">
            <div>
              <div class="pull-left">
                <h4>Available Filters</h4>
              </div>
              <div class="pull-right">
                <div class="button_controls">
                  <button ng-hide="sidebar" ng-click="sidebar=!sidebar">Show help</button>
                  <button ng-show="sidebar" ng-click="sidebar=!sidebar">Hide help</button>
                </div>
                <div class="button_controls">
                  <button ng-hide="sidebar_json" ng-click="show_sidebar_json()" class="btn">Show json</button>
                  <button ng-show="sidebar_json" ng-click="sidebar_json=!sidebar_json" class="btn">Hide json</button>
                </div>
              </div>
              <div class="pull-left button_controls">
                <h4>
                  Match strategy                
                  <div><input type="radio" ng-model="matchPolicy" name="match_policy" value="include_all" >include_all</input></div>
                  <div><input type="radio" ng-model="matchPolicy" name="match_policy" value="include_any" >include_any</input></div>
                  <div><input type="radio" ng-model="matchPolicy" name="match_policy" value="exclude_all" >exclude_all</input></div>
                  <div><input type="radio" ng-model="matchPolicy" name="match_policy" value="exclude_any" >exclude_any</input></div>
                <h4>
              </div>
              <div class="pull-left button_controls">
                <h4>
                  Annotation actions 
                  <div><input type="checkbox" data-col="1" ng-model="action_create">Create</input><div>
                  <div><input type="checkbox" data-col="1" ng-model="action_edit">Edit</input><div>
                  <div><input type="checkbox" data-col="1" ng-model="action_delete">Delete</input><div>
                </h4>
              </div>
              <div class="pull-left button_controls">
                <h4>
                  Past
                  <div><input type="checkbox" data-col="1" ng-model="load_past">Load past</input><div>
                  Go back 
                  <div><input type="number" ng-model="go_back" step="1" min="1" max="60" value="5"/> min(s)<div>
                </h4>
              </div>
            </div>
            <div class="searchbar">
              <h4>
                Search options
                <input class="searchinput" type="text" ng-model="clauses" placeholder="any"/>
              </h4>
            </div>
            <div class="center_button button_controls ">
              <button ng-hide="streaming" ng-click="start_streaming()" class="btn check-icon">Start streaming</button>
              <button ng-show="streaming" ng-click="stop_streaming()" class="btn check-icon">Stop streaming</button>
            </div>
          </div>
        </div>
      </div>   
     
      <ul class="small-padding content paper">
        <div class="knockout noise">
          <div class="metadata">
            <div>
              <li class="stream-list" ng-repeat="annotation in annotations">
                <div class="page">
                  <strong>{{annotation['user'] | userName}}</strong>
                  <span ng-switch="annotation['action']">
                    <span ng-switch-when="create">&nbsp;has created an annotation</span>
                    <span ng-switch-when="update">&nbsp;has updated an annotation</span>
                    <span ng-switch-when="delete">&nbsp;has deleted an annotation</span>
                  </span> 
                  <div class="domain">
                    <img class="favicon" ng-model="annotation['favicon']"/>
                    <a href="{{annotation['uri']}}">{{annotation['title']}}</a> 
                    | 
                    <a href="{{annotation['source']}}">{{annotation['source_stripped']}}</a>
                  </div>
                </div>

                <div class="paper excerpt">
                  <blockquote>{{annotation['quote']}}</blockquote>
                </div>

                <div class="paper thread">
                  <div class="annotation detail">
                    <div class="magicontrols pull-right">
                      <span class="small">{{annotation['updated'] | fuzzyTime}}</span>
                    </div>
                    <strong>
                      <span class="user">{{annotation['user'] | userName}}</span>
                    </strong>
                    <div class="body">{{annotation['text']}}</div>
                  </div>
                </div>
              </li>
            </div>
          </div>
        </div>
      </ul>
     </div>

     <div class="side-bar-left" ng-show="sidebar_json" ng-animate="{show: 'sidebar_anim_show_left', hide: 'sidebar_anim_hide_left'}">
       <div class="sidebar-content paper">
         <h4>Generated filter json
         <pre ng-bind-html-unsafe="json_content"/>
         </h4>
         <div class="center_button">
           <button ng-click="show_sidebar_json()" class="btn">Refresh</button>
           <button ng-click="sidebar_json=!sidebar_json" class="btn">Close sidebar</button>
         </div>
       </div>
     </div>

     <div class="side-bar-right" ng-show="sidebar" ng-animate="{show: 'sidebar_anim_show_right', hide: 'sidebar_anim_hide_right'}">
       <div class="sidebar-content paper">
        <h4>
          Little help for the search options syntax. 
        </h4>  
        <h4>
          This is still experimental and our goal is to form it as natural as possible.
        </h4>
        <h4>  
          <li>
            Currently you can type search clauses, separated by space characters.
          </li>  
          <li>
            A search clause has the following structure: <strong>(field):(operator)(value)</strong> (i.e. <strong>user:=johndoe</strong> )
          </li>  
          <li>
            The fields can be one of the followings: <strong>['thread', 'text', 'user']</strong>
          </li>
          <li>
            Operators: <strong>['=', '>', '<', '=>', '<=', '[', '#']</strong>
          </li>  
          <li>
            Where '[' means a comma separated list. I.e. <strong>user:[johndoe,janedoe</strong> means the user is either johndoe or janedoe
          </li>  
          <li>
            '#' means matching (or substring). i.e <strong>text:#car</strong> means every annotation which has the 'car' character string in it's body.   
          </li>
        </h4>  
      </div>

     </div>
   </div>
  </body>
</html>
