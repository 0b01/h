<!DOCTYPE html>
<html lang="en" metal:use-macro="main_template">
  <head>
    <link rel="stylesheet"
          metal:fill-slot="css_links"
          tal:attributes="href href"
          tal:repeat="href webassets(request, 'app_css') | []" />
  </head>
  <body data-ng-app="h"
        data-ng-controller="Hypothesis"
        metal:fill-slot="body">
    <div id="toolbar" class="form-inline">
      <div class="tri"></div>
      <div class="tinyman">
        <form id="persona"
              action
              method="POST"
              enctype="multipart/form-data"
              accept-charset="utf-8">
          <input name="__formid__" type="hidden" value="persona" />
          <a data-ng-hide="persona"
             data-ng-click="showAuth()">Sign in</a>
          <div class="dropdown"
               data-ng-show="persona">
            <a role="button"
               class="dropdown-toggle"
               data-toggle="dropdown"
               >{{persona.username}}<span class="provider"
                                          >/{{persona.provider}}</span></a>
            <ul class="dropdown-menu pull-right"
                role="menu">
              <li data-ng-repeat="option in personas">
                <a data-ng-click="persona = personas[$index]"
                   >{{option.username}}/{{option.provider}}</a>
              </li>
              <li>
                <a data-ng-click="persona = null">Sign out</a>
              </li>
            </ul>
          </div>
        </form>
      </div>
    </div>
    <div id="gutter">
      <header class="sheet" data-ng-model="auth" data-ng-submit="submit()">
        <a class="close" data-ng-click="showAuth(false)"></a>
        <ul class="nav nav-tabs">
          <li><a data-target="#auth-tab"
                 data-toggle="tab">Log in</a></li>
          <li><a data-target="#register-tab"
                 data-toggle="tab">Sign up</a></li>
          <li><a data-target="#forgot-tab"
                 data-toggle="tab">Forgot your password?</a></li>
          <li><a data-target="#activate-tab"
                 data-toggle="tab">Set your password</a></li>
        </ul>
        <div class="tab-content form-vertical">
          <div tal:repeat="name ['login', 'register']"
               tal:attributes="id '%s-tab' % name"
               class="tab-pane">
            ${structure: layout.forms[name].render()}
            <footer>
              <ul>
                <li>
                  <a onclick="$('.nav a[data-target]')
                                .filter('[data-target=#forgot-tab]')
                                .tab('show')"
                     >Password help?</a>
                </li>
                <li>
                  <a onclick="$('.nav a[data-target]')
                              .filter('[data-target=#activate-tab]')
                              .tab('show')"
                     >Have you already reserved a username with us?</a>
                </li>
              </ul>
            </footer>
          </div>
          <div id="forgot-tab" class="tab-pane">
            ${structure: layout.forms['forgot'].render()}
          </div>
          <div id="activate-tab" class="tab-pane">
            ${structure: layout.forms['activate'].render()}
          </div>
        </div>
      </header>
      <div id="wrapper">
      </div>
    </div>
    <script type="text/javascript"
            tal:attributes="src src"
            tal:repeat="src webassets(
                        request,
                        'angular',
                        'annotator',
                        'd3',
                        'easyXDM',
                        'handlebars',
                        'jwz',
                        'pagedown',
                        'templates',
                        'underscore')"></script>
  </body>
</html>
